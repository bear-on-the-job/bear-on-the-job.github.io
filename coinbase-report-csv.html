  
<html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://dl.dropboxusercontent.com/s/3z3fmnofhbsjfb4/BTC-USD-csv.js"></script>
<script>    
  //var csv is the CSV file with headers
  function csvToArray(csv){
    var lines=csv.split("\n");
    var result = [];
    var headers=lines[0].split(",");

    for(var i=1;i<lines.length;i++){
      var obj = {};
      var currentline=lines[i].split(",");
      for(var j=0;j<headers.length;j++){
        obj[headers[j]] = currentline[j];
      }
      result.push(obj);
    }
    
    return result;
    //return JSON.stringify(result); 
  }
  
  function transformFills(fills) {
    var result = {};
    for(var fill of fills) {
      var product = result[fill["size unit"]] ??= {
        "total-amount": 0.0,
        "total-cost": 0.0,
        "average-cost": 0.0,
      };
      
      product["total-amount"] += parseFloat(fill["size"]);
      product["total-cost"] += (parseFloat(fill["size"]) * parseFloat(fill["price"]));
      product["average-cost"] = product["total-cost"] / product["total-amount"];      
    }
    
    return result;
  }

  var fills = [];

  for(var product in csvReports) {
    fills = [...csvToArray(product)];
  }
  
  var transformed = transformFills(fills);
  document.write(JSON.stringify(transformed));  
  
  /*
  B=SUM(SUMIF(Coinbase!$G$2:$G, A2, Coinbase!$F$2:$F), SUMIF(AnchorUSD!$G$2:$G, A2, AnchorUSD!$F$2:$F), SUMIF(FixedFloat!$E$2:$E, A2, FixedFloat!$F$2:$F), SUMIF(FixedFloat!$I$2:$I, A2, FixedFloat!$J$2:$J))
  G=SUM(SUMPRODUCT(Coinbase!$F$2:$F, Coinbase!$H$2:$H*(Coinbase!$G$2:$G=A2)*(Coinbase!$D$2:$D="BUY")),SUMPRODUCT(AnchorUSD!$F$2:$F, AnchorUSD!$H$2:$H*(AnchorUSD!$G$2:$G=A2)*(AnchorUSD!$D$2:$D="BUY")),SUMPRODUCT(FixedFloat!$F$2:$F, FixedFloat!$G$2:$G*(FixedFloat!$E$2:$E=A2)),-SUMPRODUCT(FixedFloat!$F$2:$F, FixedFloat!$G$2:$G*(FixedFloat!$I$2:$I=A2)))
  AVG==IF(B>0, G/B, 0)
  */
  
</script>
<body style="background-color:#333333; color: #CCCCCC;"></body>
</html>

